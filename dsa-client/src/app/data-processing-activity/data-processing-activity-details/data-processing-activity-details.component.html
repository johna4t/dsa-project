<div class="container mt-5" *ngIf="activity">
  <form>
    <h2>Processing activity details: {{ activity.name }}</h2>

    <!-- Main Details Card -->
    <div class="card p-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Data Processing Activity</mat-label>
        <input matInput [value]="activity.name" readonly />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Data Processor</mat-label>
        <input
          matInput
          [value]="activity.dataProcessor?.name"
          readonly
          (click)="viewDataProcessor(activity.dataProcessor!.id)"
          style="cursor: pointer"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Data Asset</mat-label>
        <input
          matInput
          [value]="activity.dataContentDefinition?.name"
          readonly
          (click)="viewDataContentDefinition(activity.dataContentDefinition!.id)"
          style="cursor: pointer"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Description</mat-label>
        <textarea matInput [value]="activity.description" readonly></textarea>
      </mat-form-field>
    </div>
    <br />
    <!-- Actions Performed Accordion -->
    <mat-accordion class="mt-3">
      <mat-expansion-panel class="mat-elevation-z0 custom-expansion-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h3 class="m-0">View actions performed</h3>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="p-2">
          <table
            mat-table
            [dataSource]="activity.actionsPerformed"
            class="mat-elevation-z0 w-100"
            *ngIf="(activity.actionsPerformed?.length ?? 0) > 0; else noActions"
          >
            <!-- Action Type Column -->
            <ng-container matColumnDef="actionType">
              <th mat-header-cell *matHeaderCellDef>Action</th>
              <td mat-cell *matCellDef="let action">
                {{ toTitleCase(action.actionType) }}
              </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let action">
                {{ action.description || 'No description' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['actionType', 'description']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['actionType', 'description']"></tr>
          </table>

          <ng-template #noActions>
            <p>No actions performed recorded for this activity.</p>
          </ng-template>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <div class="mt-3" align="right">
      <!-- Edit Button Only -->
      <button mat-flat-button color="primary" style="margin: 5px" (click)="updateDataProcessingActivity(activity.id)">
        Edit
      </button>


    <!-- Back Button Only -->
      <button mat-flat-button color="accent" style="margin: 5px" (click)="goBack()">
        Back
      </button>
    </div>
  </form>
</div>
